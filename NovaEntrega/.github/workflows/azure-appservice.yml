# Nome do workflow - aparece no GitHub Actions
name: Deploy to Azure App Service

# Define quando o workflow vai rodar
on:
  push:
    branches:
      - main   # Roda quando faz push na branch main
      - master # Ou na branch master
  workflow_dispatch:  # Também pode rodar manualmente pelo botão no GitHub

# Variáveis de ambiente - valores que podem ser reutilizados
env:
  AZURE_WEBAPP_NAME: servidor-pi  # ⚠️ IMPORTANTE: Altere para o nome do seu App Service no Azure
  DOTNET_VERSION: '8.0.x'  # Versão do .NET que vamos usar

# Jobs - tarefas que o workflow vai executar
jobs:
  build:
    steps:
      - name: Checkout code
        uses: actions/checkout@v4  # Ação do GitHub que baixa o código

      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: ${{ env.DOTNET_VERSION }}  # Usa a versão que definimos acima

      - name: Restore dependencies
        working-directory: NovaEntrega
        run: dotnet restore

      - name: Build with dotnet
        working-directory: NovaEntrega
        run: dotnet build Servidor_PI.sln --configuration Release

      - name: dotnet publish
        working-directory: NovaEntrega
        run: dotnet publish Servidor_PI.csproj --configuration Release --output ./publish

      - name: Upload artifact for deployment job
        working-directory: NovaEntrega
        uses: actions/upload-artifact@v4
        with:
          name: dotnet-app
          path: publish

      - name: Deploy to Azure Web App
        working-directory: NovaEntrega
        uses: azure/webapps-deploy@v3
        with:
          app-name: ${{ env.AZURE_WEBAPP_NAME }}
          publish-profile: ${{ secrets.AZURE_WEBAPP_PUBLISH_PROFILE }}
          package: ./publish
